# 교착 상태

## 정의

> 프로세스/스레드가 결코 일어날 수 없는 특정 이벤트를 기다리는 상태


## 필요조건 (****모두 성립해야 발생)****

1️⃣ 상호 배제 조건 : 한번에 한개의 프로세스만이 공유 자원을 사용할 수 있어야 합니다.

2️⃣ 점유와 대기 : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용되고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 합니다.

3️⃣ 비선점 : 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없어야합니다.

4️⃣ 순환 대기 : 공유자원과 공유자원을 사용하기 위해 대기하는 프로세스들이 원형으로 구성되어 있어 자신에게 할당된 자원을 점유하면서 앞이나 뒤에 있는 프로세스의 자원을 요구해야 합니다.

## 해결 방안

### 예방

- 교착상태가 발생하지 않도록 사전에 시스템을 제어하는 방법
- 교착 상태가 발생할 수 있는 4가지 조건 중 하나라도 발생하지 않도록 하여 예방

1️⃣ **상호 배제(Mutual Exclusion)부정 :** 한번에 여러개의 프로세스가 공유 자원을 사용할 수 있도록 합니다.

2️⃣ **점유 및 대기(Hold and Wait) 부정 :** 프로세스가 실행되기 전 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나 자원이 점유되지 않은 상태에서만 자원을 요구하도록 합니다.

3️⃣ **비선점(Non-preemption)부정 :** 자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 자원을 반납하고, 요구한 자원을 사용하기 위해 기다리게 합니다.

4️⃣ **환형 대기(Circular Wait)부정 :** 자원을 선형 순서로 분류하여 고유 번호를 할당하고, 각 프로세스는 현재 점유한 자원의 고유 번호보다 앞이나 뒤 어느 한쪽 방향으로만 자원을 요구하도록 하는것입니다.

### 회피

- 교착 상태가 발생하기 전에 교착 상태를 예상하여 안전한 상태(safe state)에서만 자원 요청을 허용하는 방법
- 대표적으로 은행원 알고리즘이 있다.

👀 은행원 알고리즘 : 리소스 요청을 허락해줬을 때 교착 상태가 발생할 가능성이 있으면 리소를 할당해도 안전할 때 까지 계속 요청을 거절하는 알고리즘

### 탐지(Detection)

- 탐지 알고리즘을 통해 교착 상태를 탐지함
- 지속적으로 확인하는 작업이 필요하기 때문에 성능 저하가 발생

### 회복(Recovery)

- 교착 상태 일으킨 프로세스를 종료하거나, 할당된 자원을 해제시켜 회복시키는 방법

> **프로세스 종료 방법**
> 
> - 교착 상태의 프로세스를 모두 중지
> - 교착 상태가 제거될 때까지 하나씩 프로세스 중지
> 
> **자원 선점 방법**
> 
> - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당 (해당 프로세스 일시정지 시킴)
> - 우선 순위가 낮은 프로세스나 수행 횟수 적은 프로세스 위주로 프로세스 자원 선점

### 무시

- 교착 상태가 드물게 발생하는 시스템에서 일반적으로 사용하는 방법
- 교착 상태가 드물게 발생하여 **해결하는 비용이 효율적이지 않다**고 생각하여 교착 상태가 발생하지 않는다고 가정하여 무시
- 예를들어 WINDOW, UNIX와 같은 운영체제에서 교착 상태 무시 / 만약 발생한다면 사용자가 직접 프로세스 종료 및 시스템 재부팅

---

# 기아상태

> 특정 프로세스의 우선순위가 낮아서 원하는 자원을 계속 할당 받지 못하는 상태를 말한다.
> 

### 기아상태 해결 방안

기아상태는 주로 다음과 같은 방법으로 해결한다.

- 프로세스 우선순위 수시 변경을 통해 각 프로세스 높은 우선순위를 가지도록 기회 부여
- 오래 기다린 프로세스의 우선순위 높이기
- 우선순위가 아닌 요청 순서대로 처리하는 요청큐 사용


### Deadlock vs Starvation

- 교착상태 : 여러 프로세스가 동일 자원 점유를 요청할 때 발생
- 기아상태 : 여러 프로세스가 부족한 자원을 점유하기 위해 경쟁할 때 발생

