## 웹 서버

- **HTTP 프로토콜**을 이용하여 html 데이터를 클라이언트에게 제공해주는 서버이다.
- HTTP 프로토콜이란 OSI 7 계층인 **application layer**에 위치한 프로토콜로서 브라우저(클라이언트)와 서버 사이에 정보를 주고 받기 위한 프로토콜로 사용된다.
- 웹(사이트)를 이용한다면, 사이트로 들어갈 때, 어떤 방식을 사용해서, 서버는 어떻게 응답할 것인지를 정해놓은 약속이다.
- 웹서버로는 Nginx 와 Apache 등이 있다.

### Nginx

- **Nginx란 트래픽이 많은 웹사이트의 서버(WAS)를 도와주는 비동기 이벤트 기반구조의 경량화 웹 서버 프로그램입니다.**
- 클라이언트로부터 요청을 받았을 때 요청에 맞는 **정적 파일을 응답해주는 HTTP Web Server**로 활용되기도 하고, 또는 **Reverse Proxy Server**로 활용하여 **WAS의 부하를 줄일 수 있는 로드밸런서 역할**을 하기도 합니다.

### **장단점**

**Nginx의 장점**

- 이벤트 중심 접근 방식을 사용하여 클라이언트 요청 제공
- 제한된 하드웨어 리소스로도 여러 클라이언트 요청을 동시에 효율적으로 처리
- 단일 스레드를 통해 여러 연결을 처리 가능
- 최소한의 리소스로 웹 서버의 아키텍처를 개선하기 위해 독립형 HTTP 서버로 배치 가능

**Nginx의 단점**

- 동적 컨텐츠를 기본적으로 처리 할 수 없음
- 동적 콘텐츠에 대한 PHP 및 기타 요청을 처리하려면 NGINX가이를 실행하기 위해 외부 프로세서로 전달하고 렌더링 된 콘텐츠가 다시 전송 될 때까지 기다려야함(프로세스 속도 저하).
- 즉, 동적 웹 페이지 컨텐츠를 가진 모든 요청을 위해 외부 자원과 연계(php-fpm)

### 결론

**Apache의 한계**

![image](https://github.com/kj-cs-study/CS-Study/assets/110380812/fd4c468c-7b28-4e97-aa38-0fce27cf2a2d)


**클라이언트 접속마다 Process 혹은 Thread 를 생성하는 구조입니다.** 1만 클라이언트로부터 동시접속 요청이 들어온다면 CPU 와 메모리 사용이 증가하고 추가적인 **Process/Tread 생성비용이 드는 등 대용량 요청에서 한계를 보입니다.** 또한, **Apache 서버의 프로세스가 blocking 될 때 요청을 처리하지 못하고 처리가 완료될 때까지 대기상태에 있습니다.** 이는 Keep Alive(접속대기) 로 해결이 가능하지만, 효율이 떨어집니다.

**Nginx 의 정리**

![image](https://github.com/kj-cs-study/CS-Study/assets/110380812/765e886a-5bca-408c-864d-65bf99fcb8db)

**Nginx 는 Event-Driven 방식으로 동작합니다.** 즉, 프로그램 흐름이 이벤트에 의해 결정이 됩니다. 한 개 또는 고정된 프로세스만 생성하고, 그 내부에서 **비동기로 효율적인 방식으로 task 를 처리**합니다. **Apache 와 달리 동시접속자 수가 많아져도 추가적인 생성비용이 들지 않습니다.**

- 비동기 이벤트 기반으로 요청하여 적은양의 스레드가 사용되기 때문에 CPU소모가 적습니다.
- Apache 와 달리 CPU 와 관계없이 I/O 들을 전부 Event Listener로 미루기 때문에 흐름이 끊이지 않습니다.
- context switching 비용이 적습니다.
