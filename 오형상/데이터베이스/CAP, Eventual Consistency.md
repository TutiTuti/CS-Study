# CAP

- **분산 컴퓨팅 시스템에서 보장해야하는 시스템**
- 어떤 분산 시스템이더라도 **Consistency** (일관성), **Availability** (가용성), **Partition tolerance** (분할 내성)**를 모두 만족할 수 없다는 이론이다.**
- **Consistency(일관성)** : 데이터가 일관성이 있어야 한다. 모든 노드들은 동시에 같은 데이터를 보아야 한다
    - 여러 클라이언트는 동시에 같은 데이터를 봐야한다. 즉, 같은 시간에 조회하는 데이터는 항상 동일한 데이터여야한다
    - NoSQL은 eventual consistency
- **Availability(가용성)** : 모든 노드는 **항상 읽기와 쓰기가 가능해야한다**
    - replication : DB 서버가 장애가 발생하더라도 다른 서버에 있는 데이터를 가져와 계속 서비스 할 수 있다
        - 방법
            1. master slave
            2. peer to peer
- **Partition tolerance** : **물리적인 네트워크 파티션을 넘어서도 잘 동작하여야 한다**
    - 샤딩 : Scale out 수평적 확장을 해도 잘 동작해야 한다
    - 둘 이상의 DB 서버가 네트워크에 문제 생겨도 각 서버는 잘 동작해야한다
    

# Eventual Consistency

> 항목이 새롭게 업데이트되지 않는다는 전제하에 항목의 모든 읽기 작업이 최종적으로는 마지막으로 업데이트된 값을 반환한다는 것을 이론적으로 보장합니다
> 

분산 시스템을 구성하려면 CAP 이론에 의해서 일관성과 가용성 중 하나를 포기해야하는 상황이 올 수 있습니다.

클라이언트의 요청을 받았을 때, A서버의 데이터가 변경되면 즉시 다른 서버에 반영되지 않습니다. 아래 두가지 경우가 있습니다.

1. 모든 서버가 동일한 데이터를 갖도록 동기화 하는동안 클라이언트의 접근을 막는 경우 (가용성의 문제)
2. 다른 클라이언트들이 변경된 데이터를 요청했을 때 어떤 클라이언트는 최신의 데이터를, 어떤 클라이언트는 오래된 데이터를 받게되는 경우.(일관성의 문제)

그러나 2번의 경우 **언젠가는 동기화가 되면**, 모든 클라이언트가 동일한 데이터를 받아볼 수 있게 됩니다.
